```
DYNAMIC INVENTORY IN ANSIBLE (AWS EC2)

=====================================
WHAT IS DYNAMIC INVENTORY?
=====================================

In Ansible, inventory means the list of servers.

Static Inventory Example:
[web]
192.168.1.10
192.168.1.11

Problem:
In cloud environments like AWS:
- Servers are created automatically
- Servers are terminated automatically
- IP addresses change
- Auto Scaling adds/removes instances

Maintaining static inventory becomes difficult.

Solution:
Dynamic Inventory automatically fetches the list of servers from cloud (AWS, GCP, Azure).

=====================================
WHAT THIS PYTHON SCRIPT DOES
=====================================

This script is a custom Dynamic Inventory for AWS EC2.

It:
1. Connects to AWS
2. Fetches all EC2 instances
3. Filters only running instances
4. Gets their Public IP addresses
5. Sends them to Ansible in JSON format

=====================================
STEP-BY-STEP CODE EXPLANATION
=====================================

1) #!/usr/bin/env python
   → Tells system to run script using Python.

2) import json
   import boto3
   → json converts data into JSON format.
   → boto3 is AWS Python SDK used to connect to AWS.

3) ec2 = boto3.client('ec2')
   → Connects to AWS EC2 service.

4) instances = ec2.describe_instances()
   → Gets details of all EC2 instances.

5) Inventory Structure:
   {
     'all': {
        'hosts': [],
        'vars': {
           'ansible_user': 'ec2-user',
           'ansible_ssh_private_key_file': '/path/to/key'
        }
     },
     '_meta': {
        'hostvars': {}
     }
   }

   → hosts = list of server IPs
   → ansible_user = SSH username
   → ansible_ssh_private_key_file = private key path
   → _meta = host-specific variables

6) Loop through AWS response:
   for reservation in instances['Reservations']:
       for instance in reservation['Instances']:

   → AWS data is nested, so we loop through it.

7) Filter running instances:
   if instance['State']['Name'] == 'running':

   → Only active servers are included.

8) Get Public IP:
   public_ip = instance['PublicIpAddress']

9) Add IP to inventory:
   inventory['all']['hosts'].append(public_ip)

10) Add host variables:
   inventory['_meta']['hostvars'][public_ip] = {
       'ansible_host': public_ip
   }

11) Print JSON output:
   print(json.dumps(inventory, indent=2))

   → Ansible reads this JSON as inventory.

=====================================
FINAL OUTPUT EXAMPLE
=====================================

{
  "all": {
    "hosts": ["3.110.25.10", "13.234.44.22"],
    "vars": {
      "ansible_user": "ec2-user",
      "ansible_ssh_private_key_file": "/path/to/key"
    }
  }
}

=====================================
WHY THIS IS IMPORTANT
=====================================

In real DevOps environments:
- Auto Scaling creates new EC2 instances
- Old EC2 instances are terminated
- IP addresses change frequently

Static inventory → Playbook may fail.
Dynamic inventory → Always fetches updated server list automatically.

=====================================
ONE LINE SUMMARY
=====================================

Dynamic Inventory automatically asks AWS which servers are running and uses them in Ansible.


```














# Inventory 

Ansible inventory file is a fundamental component of Ansible that defines the hosts (remote systems) that you want to manage and the groups those hosts belong to. The inventory file can be static (a simple text file) or dynamic (generated by a script). It provides Ansible with the information about the remote nodes to communicate with during its operations.

## Static Inventory

A static inventory file is typically a plain text file (usually named hosts or inventory) and is structured in INI or YAML format. Here are examples of both formats:

### INI Format

```
# inventory file: hosts

[webservers]
web1.example.com
web2.example.com

[dbservers]
db1.example.com
db2.example.com

[all:vars]
ansible_user=admin
ansible_ssh_private_key_file=/path/to/key
```

### YAML

```
# inventory file: hosts.yaml

all:
  vars:
    ansible_user: admin
    ansible_ssh_private_key_file: /path/to/key
  children:
    webservers:
      hosts:
        web1.example.com:
        web2.example.com:
    dbservers:
      hosts:
        db1.example.com:
        db2.example.com:
```

## Dynamic Inventory

A dynamic inventory is generated by a script or plugin and can be used for environments where hosts are constantly changing (e.g., cloud environments). The script or plugin fetches the list of hosts from a source like AWS, GCP, or any other dynamic source.

Here is an example of a dynamic inventory script for AWS EC2:

```
#!/usr/bin/env python

import json
import boto3

def get_aws_ec2_inventory():
    ec2 = boto3.client('ec2')
    instances = ec2.describe_instances()
    inventory = {
        'all': {
            'hosts': [],
            'vars': {
                'ansible_user': 'ec2-user',
                'ansible_ssh_private_key_file': '/path/to/key'
            }
        },
        '_meta': {
            'hostvars': {}
        }
    }

    for reservation in instances['Reservations']:
        for instance in reservation['Instances']:
            if instance['State']['Name'] == 'running':
                public_ip = instance['PublicIpAddress']
                inventory['all']['hosts'].append(public_ip)
                inventory['_meta']['hostvars'][public_ip] = {
                    'ansible_host': public_ip
                }

    print(json.dumps(inventory, indent=2))

if __name__ == '__main__':
    get_aws_ec2_inventory()
```

## Usage

```
ansible-playbook -i inventory <Adhoc command or Playbook.yml>
```
